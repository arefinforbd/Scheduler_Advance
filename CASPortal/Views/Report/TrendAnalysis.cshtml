
@{
    ViewBag.Title = "TrendAnalysis";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="@Url.Content("~/Content/tree/themes/default/style.min.css")" rel="stylesheet" type="text/css" />

<div id="page-wrapper">
    <br />
    <div class="panel panel-info">
        <div class="panel-heading">
            <label>Trend Analysis Report</label>
        </div>
        <div class="panel-body">
            <div id="jstree">
                @Html.Raw(@ViewBag.TreeNodes)
            </div>
        </div>
        <div class="panel-footer">
            <div id="div_btnContinue">
                <input id="btnPreview" class="btn btn-info submitClass" value="Preview" type="button" name="submit">
            </div>
        </div>
    </div>
    <br />
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    Line Chart
                </div>
                <div class="panel-body">
                    <div id="divLineLabels"></div>
                    <div class="flot-chart">
                        <canvas id="canvas" height="120"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    Pie Chart
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="flot-chart">
                        <div class="flot-chart-content" id="flot-pie-chart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    Bar Chart
                </div>
                <div class="panel-body">
                    <div id="morris-bar-chart"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    var labels = [];
    var yaxisvalues = [];
    var dataset = [];
    var lineColor = "";
    var randomColorFactor = function () { return Math.round(Math.random() * 250) };

    function LineColor() {
        lineColor = randomColorFactor() + "," + randomColorFactor() + "," + randomColorFactor();
    }

    $(function () {

        $('#jstree').jstree({
            "checkbox": {
                "keep_selected_style": false
            },
            "plugins": ["checkbox"]
        });

        $('#jstree').on('changed.jstree', function (e, data) {
            var i, j, r = [];
            for (i = 0, j = data.selected.length; i < j; i++) {
                r.push(data.instance.get_node(data.selected[i]).text);
            }
            alert('Selected: ' + r.join(', '));
            alert(data.node.id + " " + data.node.text);
        })
          .jstree();

        $.ajax({
            type: "GET",
            datatype: "json",
            url: "/Report/GetLineData",
            data: {}
        })
        .done(function (result) {
            var html = "";
            for (var index = 0; index < result.length; index++) {
                if (index % 12 == 0 && index > 0) {
                    LineColor();
                    dataset.push({
                        fillColor: "rgba(255,255,255,0)",
                        strokeColor: "rgba(" + lineColor + ",0.6)",
                        pointColor: "rgba(" + lineColor + ",0.6)",
                        pointStrokeColor: "#fff",
                        pointHighlightFill: "#fff",
                        pointHighlightStroke: "rgba(" + lineColor + ",1)",
                        data: yaxisvalues
                    });
                    yaxisvalues = [];

                    html += '<div style="background-color: rgba(' + lineColor + ',0.8);width: 12px; height: 12px; float: left; margin-top: 2px;"></div>';
                    html += '<div style="font-size: 12px; margin-left: 5px; float: left; margin-right: 5px;">' + result[index-1].label + '</div>';
                }
                yaxisvalues.push([result[index].y]);
            }

            LineColor();
            dataset.push({
                fillColor: "rgba(255,255,255,0)",
                strokeColor: "rgba(" + lineColor + ",0.6)",
                pointColor: "rgba(" + lineColor + ",0.6)",
                pointStrokeColor: "#fff",
                pointHighlightFill: "#fff",
                pointHighlightStroke: "rgba(" + lineColor + ",1)",
                data: yaxisvalues
            });

            html += '<div style="background-color: rgba(' + lineColor + ',0.8);width: 12px; height: 12px; float: left; margin-top: 2px;"></div>';
            html += '<div style="font-size: 12px; margin-left: 5px; float: left; margin-right: 5px;">' + result[index-1].label + '</div>';
            $("#divLineLabels").html(html);

            for (var index = 0; index < 12; index++) {
                labels.push([result[index].x]);
            }

            var lineChartData = {
                labels: labels,
                datasets: dataset
            }

            var ctx = document.getElementById("canvas").getContext("2d");
            window.myLine = new Chart(ctx).Line(lineChartData, {
                responsive: true
            });
        })
        .fail(function () {
            alrt("error occured");
        });
    });
</script>