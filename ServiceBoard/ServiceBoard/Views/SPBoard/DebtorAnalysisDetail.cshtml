@{
    ViewBag.Title = "SPBoard";
    ViewBag.SubTitle = "Debtor Analysis Detail";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="@Url.Content("~/Content/css/bootstrap-multiselect.min.css")" rel="stylesheet" type="text/css" />

<style>

    .page-content > .row .col-xs-12, .page-content > .row .col-sm-12, .page-content > .row .col-md-12, .page-content > .row .col-lg-12{
        float:none;
    } 
    
    .row {
        margin-bottom: 5px;
    }

    input[readonly] {
        background: none repeat scroll 0 0 #ffffff !important;
    }

    .ui-datepicker {
        width: 240px;
    }

    .datepicker-label {
        float: left;
        margin-right: 10px;
        padding-top: 5px;
    }

    #selAreas-menu {
        height: 200px;
        overflow-y: scroll;
    }

    #selDateBalances-menu2 {
        height: 220px;
        overflow-y: scroll;
    }

    #selCharts-button {
        float: left;
        margin-right: 8px;
        height: 34px;
        background-color: #FFFFFF;
    }

    .form-control, select {
        color: #000000;
    }

    #selCharts-button .ui-selectmenu-text {
        padding-top: 6px;
    }
</style>

<div class="row">
    <div class="col-lg-12">
        <div class="widget-box">
            <div class="widget-header">
                <h4 class="widget-title">Search...</h4>
            </div>

            <div class="widget-body">
                <div class="widget-main no-padding">
                    <form>
                        <fieldset>
                            <div class="row">
                                <div class="col-lg-6 col-sm-6">
                                    <div class="row">
                                        <div class="col-lg-3 col-xs-3">
                                            <label class="block blue datepicker-label">Report As At</label>
                                        </div>
                                        <div class="col-lg-8 col-xs-8">
                                            <div class="input-group" style="width: 240px;">
                                                <input class="form-control date-picker" id="id-date-picker-1" type="text" data-date-format="dd-mm-yyyy" placeholder="Click to select" readonly="" style="cursor: pointer;" />
                                                <span class="input-group-addon" style="cursor: pointer;">
                                                    <i class="fa fa-calendar bigger-110"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-6 col-sm-6">
                                    <div class="row">
                                        <div class="col-lg-3 col-xs-3">
                                            <label class="block blue">Name From</label>
                                        </div>
                                        <div class="col-lg-8 col-xs-8">
                                            <div class="input-group" style="width: 240px;">
                                                <input class="form-control" id="txtNameFrom" type="text" />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6 col-sm-6">
                                    <div class="row">
                                        <div class="col-lg-3 col-xs-3">
                                            <label class="block blue">Name To</label>
                                        </div>
                                        <div class="col-lg-8 col-xs-8">
                                            <div class="input-group" style="width: 240px;">
                                                <input class="form-control" id="txtNameTo" type="text" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-6 col-sm-6">
                                    <div class="row">
                                        <div class="col-lg-3 col-xs-3">
                                            <label class="block blue">Customer From</label>
                                        </div>
                                        <div class="col-lg-8 col-xs-8">
                                            <div class="input-group" style="width: 240px;">
                                                <input class="form-control" id="txtCustomerFrom" type="text" />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6 col-sm-6">
                                    <div class="row">
                                        <div class="col-lg-3 col-xs-3">
                                            <label class="block blue">Customer To</label>
                                        </div>
                                        <div class="col-lg-8 col-xs-8">
                                            <div class="input-group" style="width: 240px;">
                                                <input class="form-control" id="txtCustomerTo" type="text" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-6 col-sm-6">
                                    <div class="row">
                                        <div class="col-lg-3 col-xs-3">
                                            <label class="block blue">Area</label>
                                        </div>
                                        <div class="col-lg-8 col-xs-8">
                                            <select id="selAreas" name="selArea" style="width: 200px; display: none;">
                                                @Html.Raw(ViewBag.Areas)
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row" style="margin-top:-5px;">
                                <div class="col-lg-6 col-sm-6">
                                    <div class="row">
                                        <div class="col-lg-3 col-xs-3">
                                            <label class="block blue">Days</label>
                                        </div>
                                        <div class="col-lg-8 col-xs-8">
                                            <select id="selDateBalances" name="selArea" style="width: 200px; display: none;">
                                                @Html.Raw(ViewBag.DateBalances)
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6 col-sm-6">
                                    <div class="row">
                                        <div class="col-lg-3 col-xs-3">
                                            <label class="block blue">Invoice Type</label>
                                        </div>
                                        <div class="col-lg-8 col-xs-8">
                                            @Html.Raw(ViewBag.InvoiceTypes)
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-6 col-sm-6">
                                    <div class="row">
                                        <div class="col-lg-3"></div>
                                        <div class="col-lg-8">
                                            <label>
                                                <input id="chkPrintDetails" class="ace" type="checkbox">
                                                <span class="lbl"> Print Credits Only</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-6 col-sm-6">
                                    <div class="row">
                                        <div class="col-lg-3"></div>
                                        <div class="col-lg-8">
                                            <label>
                                                <input id="chkUnInvoiced" class="ace" type="checkbox">
                                                <span class="lbl"> Include Un-Invoiced Jobs</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-6 col-sm-6">
                                    <div class="row">
                                        <div class="col-lg-3"></div>
                                        <div class="col-lg-8">
                                            <label>
                                                <input id="chkRetention" class="ace" type="checkbox">
                                                <span class="lbl"> Include Retention</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>

                        <div class="form-actions left" style="padding-left: 16px;">
                            <select id="selCharts" name="selCharts">
                                <option selected="selected">Bar</option>
                                <option>Pie</option>
                                <option>Line</option>
                            </select>

                            <input class="btn btn-sm btn-info" type="button" id="btnPreview" value="Preview" />
                            <input class="btn btn-sm btn-success" type="button" id="btnReset" value="Reset" style="margin-left:5px;width:75px;" />
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <br />
        <div id="divLoading" style="display:none;"></div>
        <div class="widget-box" id="widget-bar-chart" style="display:none;">
            <div class="widget-header">
                <h4 class="widget-title">Category Comparison</h4>
            </div>

            <div class="widget-body" style="padding:10px;">
                <div class="widget-main no-padding">
                    <div class="flot-chart-content" id="flot-bar-chart" style="margin: 10px 0 0 15px;height: 350px; width: 750px;"></div>
                </div>
            </div>
        </div>
        <br />
        <div class="widget-box" id="widget-bar-chart2" style="display:none;">
            <div class="widget-header">
                <h4 class="widget-title">Overall</h4>
            </div>

            <div class="widget-body" style="padding:10px;">
                <div class="widget-main no-padding">
                    <div class="flot-chart-content" id="flot-bar-chart2" style="margin: 10px 0 0 15px;height: 350px; width: 750px;"></div>
                </div>
            </div>
        </div>
        <br />
        <div class="widget-box" id="widget-bar-chart3" style="display:none;">
            <div class="widget-header">
                <h4 class="widget-title">YTD</h4>
            </div>

            <div class="widget-body" style="padding:10px;">
                <div class="widget-main no-padding">
                    <div class="flot-chart-content" id="flot-bar-chart3" style="margin: 10px 0 0 15px;height: 350px; width: 750px;"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="@Url.Content("~/Scripts/js/pages/bootstrap-multiselect-modified.js")"></script>

<script type="text/javascript">
    $(function () {

        $("#selAreas").css('width', '240px').selectmenu({ position: {} });
        $("#selDateBalances").css('width', '240px').selectmenu({ position: {} });
        $("#selCharts").css('width', '80px').selectmenu({ position: {} });

        $('#id-date-picker-1').datepicker({
            dateFormat: "dd MM, yy",
            showOtherMonths: true,
            selectOtherMonths: true,
            altFormat: "yy-mm-dd",
            changeMonth: true,
            changeYear: true,
            yearRange: (new Date().getFullYear() - 5) + ':' + (new Date().getFullYear() + 2)
        })
        .next().on(ace.click_event, function () {
            $(this).prev().focus();
        });

        $('#ddlinvoiceType').multiselect({
            numberDisplayed: 10,
            includeSelectAllOption: 1,
            selectAllText: "[ALL]"
        });
        $(".multiselect").addClass("btn-white");
        $(".multiselect-container label.checkbox").css("padding", "3px 20px 3px 15px");

        $("#btnPreview").click(function () {

            if (Validate() == false)
                return;

            $("#divLoading").show();
            $("#divLoading").html("<img alt='' src='" + $("#hdnSiteURL").val() + "/Content/Images/loading.gif' width='75px' />");
            LoadAJAXDebtorAnalysisDetail();
        });
    });

    function LoadAJAXDebtorAnalysisDetail() {

        var Category = $("#selCategory-button .ui-selectmenu-text").html();
        var FromDate = $("#id-date-picker-1").val();
        //var ToDate = $("#id-date-picker-2").val();

        $.ajax({
            url: $("#hdnSiteURL").val() + "/SPBoard/DebtorAnalysisDetail",
            type: "POST",
            data: { invoiceType: InvoiceType, customerFrom: CustomerFrom, customerTo: CustomerTo, sortBy: SortBy, area: Area, printCredit: PrintCredit, nameFrom: NameFrom, nameTo: NameTo, ageBal: AgeBal, unIndJobs: UnIndJobs, balanceDate: BalanceDate, retention: Retention },
            dataType: "JSON",
            success: function (data) {
                if (data != null) {
                    $("#widget-bar-chart").show();
                    LoadBarChart(data, $("#flot-bar-chart"), false);
                    LoadingComplete();
                }
                else {
                    LoadingComplete();
                    alert("There is no data to show.");
                }
            },
            error: function (request) {
                LoadingComplete();
                alert("Please try again. Something went wrong.");
            }
        });
    }

    function LoadingComplete() {
        $("#divLoading").html("");
        $("#divLoading").hide();
    }

    function Validate() {

        if ($("#id-date-picker-1").val().trim().length <= 0) {
            alert("Please select Report Date.");
            $("#id-date-picker-1").focus();
            return false;
        }

        return true;
    }
</script>